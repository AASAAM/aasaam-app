#!/bin/bash

# Enable or disable php extensions if you need: phpenmod, phpdismod
# phpenmod amqp
# phpenmod apcu
# phpenmod ast
# phpenmod bcmath
# phpenmod bz2
# phpenmod calendar
# phpenmod couchbase
# phpenmod ctype
# phpenmod curl
# phpenmod dba
# phpenmod dom
# phpenmod ds
# phpenmod enchant
# phpenmod ev
# phpenmod exif
# phpenmod fann
# phpenmod fileinfo
# phpenmod ftp
# phpenmod gd
# phpenmod geohash
# phpenmod geoip
# phpenmod geospatial
# phpenmod gettext
# phpenmod gmp
# phpenmod gnupg
# phpenmod grpc
# phpenmod hprose
# phpenmod hrtime
# phpenmod iconv
# phpenmod imagick
# phpenmod intl
# phpenmod json
# phpenmod libevent
# phpenmod mbstring
# phpenmod memcached
# phpenmod molten
# phpenmod mongodb
# phpenmod mysqli
# phpenmod mysqlnd
# phpenmod opcache
# phpenmod opencensus
# phpenmod pdo
# phpenmod pdo_mysql
# phpenmod pdo_pgsql
# phpenmod pdo_sqlite
# phpenmod pgsql
# phpenmod phar
# phpenmod phpng_xhprof
# phpenmod posix
# phpenmod psr
# phpenmod raphf
# phpenmod rar
# phpenmod readline
# phpenmod redis
# phpenmod request
# phpenmod rrd
# phpenmod seaslog
# phpenmod shmop
# phpenmod simplexml
# phpenmod soap
# phpenmod sockets
# phpenmod sodium
# phpenmod spx
# phpenmod sqlite3
# phpenmod ssh2
# phpenmod swoole
# phpenmod sync
# phpenmod sysvmsg
# phpenmod sysvsem
# phpenmod sysvshm
# phpenmod tidy
# phpenmod tokenizer
# phpenmod uv
# phpenmod v8
# phpenmod v8js
# phpenmod varnish
# phpenmod vcollect
# phpenmod vips
# phpenmod wddx
# phpenmod xdebug
# phpenmod xml
# phpenmod xmlreader
# phpenmod xmlrpc
# phpenmod xmlwriter
# phpenmod xsl
# phpenmod yac
# phpenmod yaf
# phpenmod yar
# phpenmod zip
# phpenmod zmq

# Fix permission of nginx and php app directories
mkdir -p /app/var/logs && chown www-data:www-data /app/var/logs -R
mkdir -p /app/var/tmp && chown www-data:www-data /app/var/tmp -R
mkdir -p /app/var/cache/nginx/fastcgi \
  && mkdir -p /app/var/cache/nginx/proxy \
  && chown www-data:www-data /app/var/cache/nginx -R

# Install global and local packages
# yarn global add grunt-cli
# cd /app/app && yarn install
# cd /app/app && composer update
# cd /app/app && grunt build

# Run supervisor
if [ -e "/app/etc/supervisor/supervisor.ini" ]; then
  supervisord -c /app/etc/supervisor/supervisor.ini
fi

# start php and nginx
service php7.1-fpm start
service nginx start
